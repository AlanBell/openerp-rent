<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!--
            Rent order line list view
        -->
        <record id="rent_order_line_list_view" model="ir.ui.view">
            <field name="name">rent.order.line.list</field>
            <field name="model">rent.order.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Rent Order Lines">
                    <field name="name"/>
                    <field name="begin_datetime"/>
                    <field name="duration_value"/>
                    <field name="duration_unity"/>
                    <field name="discount"/>
                    <field name="product_uom_qty" string="Qty"/>
                    <field name="product_uom" string="UoM"/>
                    <field name="price_unit" string="Price per product"/>
                    <field name="price_subtotal" string="Total price"/>
                </tree>
            </field>
        </record>

        <!--
            Rent order line form view.

            This view has been copied/pasted from the sale.order.line subview
            defined in the sale.order form view. We couldn't inherit it directly
            (see bug #703878) so we just copied it.

            We add field specific to renting: duration, duration_unity, etc.
        -->
        <record id="rent_order_line_form_view" model="ir.ui.view">
            <field name="name">rent.order.line.form</field>
            <field name="model">rent.order.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Rent Order Lines">
                    <notebook>
                        <page string="Rent Order Line">
                            <separator string="General"/>
                                <field colspan="4"
                                       context="{
                                        'partner_id' : parent.partner_id,
                                        'quantity' : product_uom_qty,
                                        'pricelist' : parent.pricelist_id,
                                        'shop' : parent.shop_id,
                                        'uom' : product_uom,
                                        'search_default_rent' : True,
                                       }"
                                       domain="[('can_be_rent', '=', True)]"
                                       name="product_id"
                                       on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], True, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                       required="True"
                                />
                                <field groups="product.group_uos" name="product_uos_qty"/>
                                <field groups="product.group_uos" name="product_uos"/>
                                <field
                                    context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                    name="product_uom_qty"
                                    on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, True)"
                                />
                                <field name="product_uom"
                                       on_change="product_uom_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order)"
                                       groups="base.group_extended"/>
                                <field
                                        name="product_packaging"
                                        context="partner_id=parent.partner_id,quantity=product_uom_qty,pricelist=parent.pricelist_id,shop=parent.shop_id,uom=product_uom"
                                        on_change="product_id_change(parent.pricelist_id,product_id,product_uom_qty,product_uom,product_uos_qty,product_uos,name,parent.partner_id, 'lang' in context and context['lang'], False, parent.date_order, product_packaging, parent.fiscal_position, False)"
                                        domain="[('product_id','=',product_id)]"
                                        groups="base.group_extended"
                                        colspan="4" />
                                <field name="company_id" groups="base.group_multi_company" readonly="1"/>
                                <field colspan="4" name="name"/>
                                <field name="price_unit"/>
                                <field name="discount"/>
                                <field name="type" groups="base.group_extended"/>
                                <field name="delay" groups="base.group_extended"/>
                                <newline/>
                            <separator string="Rent configuration" colspan="4"/>
                                <field name="begin_datetime" colspan="4"/>
                                <field name="duration_value"/>
                                <field name="duration_unity"/>
                            <newline/>
                            <separator colspan="5" string="Taxes"/>
                                <field colspan="4" name="tax_id" nolabel="1" domain="[('parent_id','=',False),('type_tax_use','&lt;&gt;','purchase')]"/>
                                <group colspan="4" col="5" groups="base.group_extended">
                                    <separator colspan="5" string="States"/>
                                    <field name="state"/>
                                    <field name="invoiced"/>
                                    <group attrs="{'invisible':[('invoiced','=',True)]}">
                                        <button colspan="1"
                                                name="%(sale.action_view_sale_order_line_make_invoice)d"
                                                states="confirmed"
                                                string="Make Invoices"
                                                type="action"
                                                icon="terp-document-new" />
                                    </group>
                                </group>
                        </page>
                        <page groups="base.group_extended" string="Extra Info">
                            <field name="th_weight"/>
                            <field name="address_allotment_id"/>
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="notes" nolabel="1"/>
                        </page>
                        <page string="History" groups="base.group_extended">
                            <separator colspan="4" string="Invoice Lines"/>
                            <field colspan="4" name="invoice_lines" nolabel="1"/>
                            <separator colspan="4" string="Stock Moves"/>
                            <field colspan="4" name="move_ids" nolabel="1" widget="many2many"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <!--
            Rent form view
        -->
        <record id="rent_sale_form_view" model="ir.ui.view">
            <field name="name">rent.sale.order.form.view</field>
            <field name="model">sale.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <field name="pricelist_id" position="before">
                    <field name="sale_type"/>
                </field>
                <field name="order_line" position="attributes">
                    <attribute name="attrs">{'invisible' : [('sale_type', '=', 'rental')]}</attribute>
                </field>
                <field name="order_line" position="after">
                    <field name="rent_order_lines" colspan="4" mode="tree,form" nolabel="1"
                           attrs="{'invisible' : [('sale_type', '=', 'sale')]}" widget="one2many_list"/>
                </field>
            </field>
        </record>
    </data>
</openerp>
